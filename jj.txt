#!/bin/bash
set -e

echo "ğŸ— Starting Ecom Frontend BUILD ONLY..."

REPO_URL="https://github.com/amaansodagar786/ecom_frontend/archive/refs/heads/main.zip"

TMP_ZIP="/tmp/ecom_frontend.zip"
TMP_DIR="/tmp/ecom_frontend"
OUTPUT_DIR="/var/www/dist-build-output"

echo "ğŸ§¹ Cleaning old temp & output..."
rm -rf "$TMP_DIR" "$TMP_ZIP" "$OUTPUT_DIR"

echo "â¬‡ï¸ Downloading source..."
wget -q -O "$TMP_ZIP" "$REPO_URL"

echo "ğŸ“‚ Extracting..."
unzip -q "$TMP_ZIP" -d /tmp
mv /tmp/ecom_frontend-main "$TMP_DIR"

cd "$TMP_DIR"

echo "ğŸ“¦ Installing dependencies..."
npm install --silent

echo "ğŸ— Building frontend..."
npm run build

echo "ğŸ“ Creating external dist output..."
mkdir -p "$OUTPUT_DIR"
cp -r "$TMP_DIR/dist/"* "$OUTPUT_DIR/"

echo "ğŸ§¼ Cleaning temp..."
rm -rf "$TMP_DIR" "$TMP_ZIP"

echo "âœ… BUILD completed successfully!"
echo "ğŸ“‚ Dist available at:"
echo "â¡  $OUTPUT_DIR"
echo "ğŸ‘‰ You can now manually copy files to /var/www as needed"
